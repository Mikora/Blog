<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="随笔">
<meta property="og:url" content="http://blog.huangcheng.com/page/2/index.html">
<meta property="og:site_name" content="随笔">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="随笔">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> 随笔 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">随笔</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/28/iOS开发中各种优化/" itemprop="url">
                  iOS开发中各种优化
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-28T11:13:48+08:00" content="2016-04-28">
              2016-04-28
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="离屏渲染">离屏渲染</h4><p>触发离屏渲染：mask, shadow, group opacity, edge antialiasing</p>
<p>对性能的影响等级：Shadow &gt; RoundedCorner &gt; Mask &gt; GroupOpacity(迷之效果)。</p>
<p>1.round corner </p>
<p>优化方案：<br>uiimage：重新绘制一张带圆角的uiimage，使用core graphics。比如</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CGRect imageFrame = CGRectMake(<span class="number">0.</span>, <span class="number">0.</span>, <span class="built_in">rect</span>.<span class="built_in">size</span>.<span class="variable">width</span>, <span class="built_in">rect</span>.<span class="built_in">size</span>.<span class="variable">height</span>);</span><br><span class="line">UIGraphicsBeginImageContextWithOptions(<span class="built_in">rect</span>.<span class="built_in">size</span>, NO, [UIScreen mainScreen].<span class="built_in">scale</span>);</span><br><span class="line">[[UIBezierPath bezierPathWithRoundedRect:imageFrame cornerRadius:<span class="number">10</span>] addClip];</span><br><span class="line">[self.<span class="built_in">image</span> drawInRect:imageFrame];</span><br><span class="line">self.<span class="built_in">image</span> = UIGraphicsGetImageFromCurrentImageContext();</span><br><span class="line">UIGraphicsEndImageContext();</span><br></pre></td></tr></table></figure>
<p> 使用一个层级去覆盖： 用一个带圆角中间透明的imageview去盖在上面<br> 问题：如何获取这个带圆角的image</p>
<p> uilabel使用layer设置颜色<br> uitextview，UITextField不影响</p>
<p> 2.shadow</p>
<p> 设置shadowpath，使用圆角优化的混合涂层方法，使用core graphics绘制引用</p>
<p> shadowpath:</p>
 <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> let imageViewLayer = avatorView<span class="class">.layer</span></span><br><span class="line">imageViewLayer<span class="class">.shadowColor</span> = UIColor.<span class="function"><span class="title">blackColor</span><span class="params">()</span></span><span class="class">.CGColor</span></span><br><span class="line">imageViewLayer<span class="class">.shadowOpacity</span> = <span class="number">1.0</span> <span class="comment">//此参数默认为0，即阴影不显示</span></span><br><span class="line">imageViewLayer<span class="class">.shadowRadius</span> = <span class="number">2.0</span> <span class="comment">//给阴影加上圆角，对性能无明显影响</span></span><br><span class="line">imageViewLayer<span class="class">.shadowOffset</span> = <span class="function"><span class="title">CGSize</span><span class="params">(width: <span class="number">5</span>, height: <span class="number">5</span>)</span></span></span><br><span class="line"><span class="comment">//设定路径：与视图的边界相同</span></span><br><span class="line">let path = <span class="function"><span class="title">UIBezierPath</span><span class="params">(rect: cell.imageView.bounds)</span></span></span><br><span class="line">imageViewLayer<span class="class">.shadowPath</span> = path.CGPath<span class="comment">//路径默认为 nil</span></span><br></pre></td></tr></table></figure>
<p> 3.mask</p>
<p> Mask 效果无法取消离屏渲染，使用混合图层的方法来模拟 mask 效果，性能各方面都是和无效果持平。</p>
<p>使用 mask 来实现圆角时也可以不用图片，而使用 CAShapeLayer 来指定混合的路径。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let roundedRectPath = <span class="function"><span class="title">UIBezierPath</span><span class="params">(roundedRect: avatorView.bounds, byRoundingCorners: .AllCorners, cornerRadii: CGSize(width: <span class="number">10</span>, height: <span class="number">10</span>)</span></span>)</span><br><span class="line">let shapeLayer = <span class="function"><span class="title">CAShapeLayer</span><span class="params">()</span></span></span><br><span class="line">shapeLayer<span class="class">.path</span> = roundedRectPath<span class="class">.CGPath</span></span><br><span class="line">avatorView<span class="class">.layer</span><span class="class">.mask</span> = shapeLayer</span><br></pre></td></tr></table></figure>
<p>4.group opacity</p>
<p>只有设置 tableView 的alpha小于1时才会触发离屏渲染，对性能无明显影响；设置 cell 的alpha属性并不会对整体的透明度产生影响，只有设置 cell.contentView 才有效。</p>
<p>5.edge antialiasing</p>
<p>开启 edge antialiasing(旋转视图并且设置layer.allowsEdgeAntialiasing = true) 在 iOS 8 和 iOS 9 上并不会触发离屏渲染，对性能也没有什么影响，也许到现在这个功能已经被优化了。</p>
<blockquote>
<p>任何时候优先考虑避免触发离屏渲染，无法避免时优化方案有两种：</p>
</blockquote>
<ul>
<li>Rasterization：适用于静态内容的视图，也就是内部结构和内容不发生变化的视图，对上面的所有效果而言，在实现成本以及性能上最均衡的。即使是动态变化的视图，开启 Rasterization 后能够有效降低 GPU 的负荷，不过在动态视图里是否启用还是看 Instruments 的数据。</li>
<li>规避离屏渲染，用其他手法来模拟效果，混合图层是个性能最好、耗能最少的通用优化方案，尤其对于 rounded corer 和 mask。</li>
</ul>
<p>notification 尽量少用</p>
<ol>
<li>需要移除，不移除将不会释放self</li>
<li>一对多，假如有两者用同一个组件，组件使用notification可能会导致微小但是致命麻烦的问题</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/27/iOS利用高斯模糊做涂抹和马赛克效果/" itemprop="url">
                  iOS利用高斯模糊做涂抹和马赛克效果
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-27T11:01:11+08:00" content="2016-04-27">
              2016-04-27
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>先不多说，上效果图</p>
</blockquote>
<p><img src="http://7xpas5.com1.z0.glb.clouddn.com/mosaic_sketch?imageView/1/w/375/h/667" alt="image"></p>
<p>demo:<a href="https://github.com/Mikora/ImageEdit" target="_blank" rel="external">github</a></p>
<p>这个和很多图片处理应用的效果一样，比如玩图的马赛克。之前已经实现过了in的涂抹效果<a href="https://github.com/Mikora/CTCamera" target="_blank" rel="external">涂抹</a></p>
<p>因为涂抹的效果和我预期的不是很理想，所以一直困扰我，当时也没什么好的想法思路，做成现在这个效果。偶然想到了这个思路，所以实现了一下模糊涂抹，下面介绍思路</p>
<blockquote>
<p>思路</p>
</blockquote>
<p>两张图片，一张原图，一张高斯模糊的图。原图作为背景绘制到view上，比如直接矩形，设置填充颜色为这个原图。画笔作为绘制的东西，路径填充色为高斯图。最后合成到一起。路径使用NSArray记录，这样可以支持前进后退。如果需要橡皮擦，则取原图为橡皮擦路径的填充色即可。</p>
<p>不用流程图示意了。</p>
<h4 id="过程">过程</h4><p>1.根据原图获得一张高斯模糊图或者马赛克图</p>
<p>推荐： 使用GPUimage，简单性能极好</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+ (UIImage*)filterForGaussianBlur:(UIImage*)<span class="built_in">image</span>&#123;</span><br><span class="line">    GPUImageGaussianBlurFilter *<span class="built_in">filter</span> = [[GPUImageGaussianBlurFilter alloc]init];</span><br><span class="line">    [<span class="built_in">filter</span> forceProcessingAtSize:<span class="built_in">image</span>.<span class="built_in">size</span>];</span><br><span class="line">    <span class="built_in">filter</span>.blurRadiusInPixels = <span class="number">10.0</span>;<span class="comment">//这个越大，越模糊，模糊半径</span></span><br><span class="line">    </span><br><span class="line">    GPUImagePicture *pic = [[GPUImagePicture alloc]initWithImage:<span class="built_in">image</span>];</span><br><span class="line">    [pic addTarget:<span class="built_in">filter</span>];</span><br><span class="line">    [pic processImage];</span><br><span class="line">    [<span class="built_in">filter</span> useNextFrameForImageCapture];</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">filter</span> imageFromCurrentFramebuffer];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其他马赛克等不做介绍</p>
<p>2.获取路径</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *lineArray;<span class="comment">//总路径</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *nowPointArray;<span class="comment">//当前手指绘制路径</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event&#123;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">super</span> touchesBegan:touches withEvent:event];</span><br><span class="line">    <span class="built_in">CGPoint</span> p = [[touches anyObject] locationInView:<span class="keyword">self</span>];</span><br><span class="line">    <span class="comment">//每次重新绘制的时候相当于一条新路径</span></span><br><span class="line">    <span class="keyword">self</span><span class="variable">.nowPointArray</span> = [[<span class="built_in">NSMutableArray</span> alloc]init];</span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.lineArray</span> addObject:<span class="keyword">self</span><span class="variable">.nowPointArray</span>];</span><br><span class="line">    [<span class="keyword">self</span> addPoint:p];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)touchesCancelled:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event&#123;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">super</span> touchesCancelled:touches withEvent:event];</span><br><span class="line">    <span class="built_in">CGPoint</span> p = [[touches anyObject] locationInView:<span class="keyword">self</span>];</span><br><span class="line">    [<span class="keyword">self</span> addPoint:p];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)touchesEnded:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event&#123;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">super</span> touchesEnded:touches withEvent:event];</span><br><span class="line">    <span class="built_in">CGPoint</span> p = [[touches anyObject] locationInView:<span class="keyword">self</span>];</span><br><span class="line">    [<span class="keyword">self</span> addPoint:p];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)touchesMoved:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event&#123;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">super</span> touchesMoved:touches withEvent:event];</span><br><span class="line">    <span class="built_in">CGPoint</span> p = [[touches anyObject] locationInView:<span class="keyword">self</span>];</span><br><span class="line">    [<span class="keyword">self</span> addPoint:p];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addPoint:(<span class="built_in">CGPoint</span>)p&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSValue</span> *point = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:p];</span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.nowPointArray</span> addObject:point];</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> setNeedsDisplay];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.绘制背景以及路径</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect&#123;</span><br><span class="line">    [<span class="keyword">super</span> drawRect:rect];</span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextSetLineCap</span>(context, k<span class="built_in">CGLineCapRound</span>);</span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(context, rect<span class="variable">.size</span><span class="variable">.width</span>);</span><br><span class="line">    <span class="built_in">CGContextSetStrokeColorWithColor</span>(context, [<span class="built_in">UIColor</span> clearColor]<span class="variable">.CGColor</span>);</span><br><span class="line">    <span class="built_in">CGContextSetFillColorWithColor</span>(context, [<span class="built_in">UIColor</span> colorWithPatternImage:<span class="keyword">self</span><span class="variable">.image</span>]<span class="variable">.CGColor</span>);</span><br><span class="line">    <span class="built_in">CGContextFillRect</span>(context, rect);<span class="comment">//绘制背景</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextSetStrokeColorWithColor</span>(context, [<span class="built_in">UIColor</span> colorWithPatternImage:<span class="keyword">self</span><span class="variable">.filterGaussan</span>]<span class="variable">.CGColor</span>);<span class="comment">//设置路径的色值</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">20</span>);</span><br><span class="line">    <span class="comment">//根据cgpoint设置路径</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="keyword">self</span><span class="variable">.lineArray</span><span class="variable">.count</span> ; i ++ ) &#123;</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *array = [<span class="keyword">self</span><span class="variable">.lineArray</span> objectAtIndex:i];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; array<span class="variable">.count</span> ; i ++ ) &#123;</span><br><span class="line">            <span class="built_in">NSValue</span> *value = [array objectAtIndex:i];</span><br><span class="line">            <span class="built_in">CGPoint</span> p = [value <span class="built_in">CGPointValue</span>];</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">CGContextMoveToPoint</span>(context, p<span class="variable">.x</span>, p<span class="variable">.y</span>);</span><br><span class="line">                <span class="built_in">CGContextAddLineToPoint</span>(context, p<span class="variable">.x</span>, p<span class="variable">.y</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">CGContextAddLineToPoint</span>(context, p<span class="variable">.x</span>, p<span class="variable">.y</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">CGContextDrawPath</span>(context, k<span class="built_in">CGPathStroke</span>);<span class="comment">//绘制路径</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/22/OC-runtime理解/" itemprop="url">
                  OC-runtime理解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-22T11:23:42+08:00" content="2016-04-22">
              2016-04-22
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="OC_runtime个人理解">OC runtime个人理解</h4><p>在类的层级结构里面，我们可以看到</p>
<p><img src="http://7xpas5.com1.z0.glb.clouddn.com/523CAC82-7C67-4D1D-9E41-08F5BAD5BD40.png?imageView/1/w/400/h/100" alt="image"></p>
<p>NSObject 包含一个指向class的isa指针</p>
<p><img src="http://7xpas5.com1.z0.glb.clouddn.com/952B1246-2130-4E52-80F8-0EB6F9B68EA4.png?imageView/1/w/450/h/145" alt="image"></p>
<p>Class是指向objc_class的指针</p>
<p><img src="http://7xpas5.com1.z0.glb.clouddn.com/9EB2AF02-A57E-46A3-B897-D22DE927C464.png?imageView/1/w/600/h/230" alt="image"></p>
<p>objc_class里面包含这些东西</p>
<p>objc_class里面的isa指针，指向metaclass</p>
<p>super_class 指向父class，如果为root，则为null</p>
<p>oc对象的isa指针会指向一个普通的class，这个class中存储所有普通成员变量和实例方法，普通的class里面的isa指针会指向静态的class，静态class中存储所有的static变量和类方法</p>
<p> 用一张图说面：</p>
<p> <img src="http://7xpas5.com1.z0.glb.clouddn.com/1413628797629491.png?imageView/1/w/275/h/280" alt="image"></p>
<p> 所有metaclass中isa指针都指向跟metaclass。而跟metaclass则指向自身。Root metaclass是通过继承Root class产生的</p>
<blockquote>
<p>在运行过程中的流程是什么？</p>
</blockquote>
<p> 例： [obj getName];</p>
<p> 编译器将代码[obj getName];转化为objc_msgSend(obj, @selector (getName));，在objc_msgSend函数中。首先通过obj的isa指针找到obj对应的class。在Class中先去cache中 通过SEL查找对应函数method，若 cache中未找到。再去methodList中查找，若methodlist中未找到，则取superClass中查找。若能找到，则将method加 入到cache中，以方便下次查找，并通过method中的函数指针跳转到对应的函数中去执行。</p>
<p> 如果没有找到指定方法，那么就会调用以下流程：</p>
<ul>
<li><p>提供一个方法实现并且告诉 runtime 你已经解析了这个方法，如果它开始查找，这回就会找到这个方法</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">+ </span>(BOOL)resolveInstanceMethod:(SEL)sel</span><br><span class="line"><span class="bullet">+ </span>(BOOL)resolveClassMethod:(SEL)sel</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>引导 Objective-C runtime 到另一个可以响应这个消息的对象上</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="pp">- <span class="params">(id)</span>forwardingTargetForSelector:<span class="params">(<span class="variable">SEL</span>)</span>aSelector</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>一个 NSInvocation 你可以改变这个消息的一切，包括目标对象，selector 和参数。 覆盖这个方法去做一些事情</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="pp">- <span class="params">(void)</span>forwardInvocation:<span class="params">(<span class="variable">NSInvocation</span> *)</span>anInvocation</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p> runtime里面有很多东西：比如获取ivar，获取method，增加ivar，method等等，具体可以查询官方文档或者在runtime的类库里面查看使用方法</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/28/使用instruments查看app性能和调试/" itemprop="url">
                  使用instruments查看app性能和调试
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-28T16:41:51+08:00" content="2016-03-28">
              2016-03-28
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h6 id="启动时间：">启动时间：</h6><p>使用time profiler查看</p>
<p>如图</p>
<blockquote>
<p>第一次加载</p>
</blockquote>
<p><img src="http://7xpas5.com1.z0.glb.clouddn.com/5E5E1189-90F4-4F79-9B3A-5996C005AB94.png?imageView/1/w/700/h/250" alt="image"></p>
<blockquote>
<p>使用后台异步加载：</p>
</blockquote>
<p><img src="http://7xpas5.com1.z0.glb.clouddn.com/243FFCBB-052E-4BBB-8382-FF4B00940492.png?imageView/1/w/680/h/200" alt="image"></p>
<p>可以看到，太多的任务被加到主线程中，导致启动时间很慢，在主线程异步去操作这些任务，大量耗时的任务不在影响启动时间。</p>
<h6 id="内存">内存</h6><p>使用Allocations和Leaks</p>
<p>不多作介绍，内存泄漏查起来有时候方便，有时候还是得靠自己定位，比如在block中循环引用，一般leaks只知道有泄漏，但是无法定位。</p>
<p>这里为了方便看应用的内存占用走势，我们可以用alloctions里面的mark genneration，进入返回viewcontroller，有一点增长是很正常的，如果太大就有问题了。</p>
<h6 id="图形和动画">图形和动画</h6><p>使用Core Animation，这个貌似只能在真机上使用</p>
<blockquote>
<p>Color Blended Layers</p>
</blockquote>
<p>Instruments可以在物理机上显示出被混合的图层Blended Layer(用红色标注)，Blended Layer是因为这些Layer是透明的(Transparent)，系统在渲染这些view时需要将该view和下层view混合(Blend)后才能计算出该像素点的实际颜色，如果这种blended layer很多，那么在滚动列表时就甭想有流畅的效果。</p>
<p>解决blended layer问题也很简单，检查红色区域view的opaque属性，记得设置成YES；检查backgroundColor属性是不是[UIColor clearColor]，要知道背景颜色为clear color那可是图形性能的大敌，基本意味着blended layer是跑不了的了，为什么？自己思考一下:)</p>
<blockquote>
<p>Color Hits Green and Misses Red</p>
</blockquote>
<p>很多视图Layer由于Shadow、Mask和Gradient等原因渲染很高，因此UIKit提供了API用于缓存这些Layer：[layer setShouldRasterize:YES]，系统会将这些Layer缓存成Bitmap位图供渲染使用，如果失效时便丢弃这些Bitmap重新生成。图层Rasterization栅格化好处是对刷新率影响较小，坏处是删格化处理后的Bitmap缓存需要占用内存，而且当图层需要缩放时，要对删格化后的Bitmap做额外计算。</p>
<p>使用这个选项后时，如果Rasterized的Layer失效，便会标注为红色，如果有效标注为绿色。当测试的应用频繁闪现出红色标注图层时，表明对图层做的Rasterization作用不大。</p>
<blockquote>
<p>Color Misaligned Images</p>
</blockquote>
<p>Misaligned Image表示要绘制的点无法直接映射到频幕上的像素点，此时系统需要对相邻的像素点做anti-aliasing反锯齿计算，增加了图形负担，通常这种问题出在对某些View的Frame重新计算和设置时产生的。</p>
<p>上图中被标注为黄色的图层，这是由于图层显示的是被缩放后的图片，如果这些图片是通过网络下载的，可以通过程序更新为确定的绘制大小来解决。还有些系统Navigation Bar和Tool Bar的背景图片使用的是拉伸(Streched)图片，也会被表示为黄色，这是属于正常情况，通常无需修改。这种问题一般对性能影响不大，而是可能会在边缘处虚化。</p>
<blockquote>
<p>Color Offscreen-Rendered Yellow</p>
</blockquote>
<p>Offscreen-Rendering离屏渲染意思是iOS要显示一个视图时，需要先在后台用CPU计算出视图的Bitmap，再交给GPU做Onscreen-Rendering显示在屏幕上，因为显示一个视图需要两次计算，所以这种Offscreen-Rendering会导致app的图形性能下降。</p>
<p>大部分Offscreen-Rendering都是和视图Layer的Shadow和Mask相关，下列情况会导致视图的Offscreen-Rendering：</p>
<p>使用Core Graphics (CG开头的类)。</p>
<p>使用drawRect()方法，即使为空。</p>
<p>将CALayer的属性shouldRasterize设置为YES。</p>
<p>使用了CALayer的setMasksToBounds(masks)和setShadow*(shadow)方法。</p>
<p>在屏幕上直接显示文字，包括Core Text。</p>
<p>设置UIViewGroupOpacity。</p>
<p>这篇博文Designing for iOS: Graphics &amp; Performance对offsreen以及图形性能有个很棒的介绍，</p>
<blockquote>
<p>Color Copied Images</p>
</blockquote>
<p>Copied Image选项可以标注应用绘制时被Core Animation复制的图片，标注成蓝绿色。虽然我在运行时遇到过，不过个人感觉对图形性能影响不大。</p>
<blockquote>
<p>Color Immediately，Flash Updated Regions， Color OpenGL Fast Path Blue</p>
</blockquote>
<p>Color Immediately选项表示Instruments在做color-flush操作时取消10毫秒的延时。<br>Flash Updated Regions选项用于用红色示标示出在屏幕上使用GPU计算绘制的图层。<br>Color OpenGL Fast Path Blue选项用于用蓝色标示出在屏幕上由OpenGL compositor绘制的内容。</p>
<p><a href="http://www.hrchen.com/2013/05/performance-with-instruments/?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io" target="_blank" rel="external">引用</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/14/iOS组件化详解/" itemprop="url">
                  iOS组件化详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-14T15:15:02+08:00" content="2016-03-14">
              2016-03-14
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="iOS组件化">iOS组件化</h2><blockquote>
<p>写在前面 </p>
</blockquote>
<p>最近看到了limboy的博客，关于iOS组件化的讲解<a href="http://limboy.me/ios/2016/03/10/mgj-components.html" target="_blank" rel="external">点击这里看详情</a></p>
<p>组件化的解释和优缺点在这篇博客中也有详细介绍</p>
<p>这里我主要介绍组件化的流程以及具体的实现方案</p>
<blockquote>
<p>首先问题引出</p>
</blockquote>
<p>「组件化」顾名思义就是把一个大的 App 拆成一个个小的组件，相互之间不直接引用。那如何做呢？</p>
<ul>
<li>拆成一个一个小组件</li>
</ul>
<p>如何拆分成一个一个小组件：常用方式有framework,libary和pod库。这里我选择pod库。</p>
<p>pod库引用，那么就需要自己去创建一个私有的pod仓库<a href="http://blog.wtlucky.com/blog/2015/02/26/create-private-podspec/" target="_blank" rel="external">教程</a>。<br>然后里面需要我们解决一些私人问题，比如需要登录信息等，那么这些就是我们组件初始化需要的数据。这里不做详细介绍，解决方法就是模拟登录。</p>
<ul>
<li>相互不直接引用</li>
</ul>
<p>这里使用一个url即可，比如列表页跳转详情页，xxx://detail?id=xxx.</p>
<p>这里我们就能考虑很多问题了：</p>
<ol>
<li>url解析</li>
<li>如何确定跳转关系</li>
<li>参数如何传递</li>
<li>如果需要回调数据</li>
<li>业务需要一次进行多个页面跳转，比如在首页到详情页，返回到列表页</li>
<li>如何识别多模式下跳转或者打开</li>
</ol>
<blockquote>
<p>解决以上问题，组件间就能成功调用</p>
</blockquote>
<p>这里是一个私有pod库，被各个业务组件引用，我称它为事件中心</p>
<ul>
<li>url解析</li>
</ul>
<p>这里我们的url是完全符合url规则的，那么我们可以使用NSUrl来解析，同样可以使用NSUrlCompents。那么我们可以获取到url中</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">scheme</span><br><span class="line"><span class="keyword">user</span></span><br><span class="line">password</span><br><span class="line">host</span><br><span class="line"><span class="keyword">port</span></span><br><span class="line">path</span><br><span class="line">query</span><br><span class="line"><span class="keyword">fragment</span></span><br></pre></td></tr></table></figure>
<p>这里我们只需要scheme,host,path,query即可</p>
<ul>
<li>如何确定跳转关系</li>
</ul>
<p>当我们把url解析出来后，我们获取到了他的path。那么我们要考虑的就是path和我们将要打开的类名对应。这里使用了协议模式，在初始化的事件中心的时候，我们会根据所有类是否实现特定协议，来做一个对应关系。</p>
<ul>
<li>参数如何传递</li>
</ul>
<p>url解析后我们获取到了query，跳转关系确定，那么我们只需要向这个对象掉用一个方法就好了，同样适用协议模式，如果实现了实例协议，便调用。</p>
<ul>
<li>需要回调数据</li>
</ul>
<p>如上功能实现后，我们就可以得到一个实例化的类，假如为viewcontroller，那我们在关闭viewcontroller的时候，或许需要回调一些数据到上层。使用block模式，在调用参数的同时把block传入到对应的类里面，各自回调协调好。</p>
<ul>
<li>业务需要一次进行多个页面跳转</li>
</ul>
<p>这里我们得到了path，path可以好几层，同样得到query，标准的url中query是支持一些数组作为参数的。这里我们就可以得到path对应的参数，path对应的类，取出所有path对应的类，最后navigation中set进去。</p>
<ul>
<li>如何识别多模式下跳转或者打开</li>
</ul>
<p>url解析中得到了一个host。我这里根据host进行判别。</p>
<blockquote>
<p>实现：正准备开源的时候，看了下面的博客。</p>
</blockquote>
<p> 所以我决定直接实现下面的方法。</p>
<blockquote>
<p>当我写到这里的时候，我看到了一篇博客<a href="http://casatwy.com/iOS-Modulization.html?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#" target="_blank" rel="external">iOS应用架构谈 组件化方案</a></p>
</blockquote>
<p>其中指出了上面这种方式的不足之处以及解决方案，于是乎我又开始的别的思路</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/11/iOS9通用链接Universal-Links/" itemprop="url">
                  iOS9通用链接Universal Links
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-11T14:15:35+08:00" content="2016-03-11">
              2016-03-11
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="iOS9通用链接Universal_Links">iOS9通用链接Universal Links</h4><p>目前我们使用打开自己应用的方法是在safari里面使用“xxxappname://”的模式。</p>
<blockquote>
<p>缺点</p>
</blockquote>
<ol>
<li>无法在一些内置浏览器里面打开应用，比如微信，QQ.</li>
<li>在safari里面打开的时候，会提升是否打开应用</li>
<li>在进行跳转的时候，会有其他网页跟随（这个可能是我们前端没有进行优化）</li>
</ol>
<p>iOS9后，苹果推出了通用链接（universal links），实现了上述功能，无缝链接到我们自己的应用上</p>
<blockquote>
<p>优点</p>
</blockquote>
<ol>
<li>通过唯一的网址, 就可以链接一个特定的视图到你的 APP 里面, 不需要特别的 schema</li>
<li>可以在任何访问这个链接的地方链接到我们的应用</li>
<li>不会影响到我们iOS9以前的打开方式</li>
</ol>
<h4 id="使用">使用</h4><blockquote>
<p>前提</p>
</blockquote>
<ol>
<li>有ssl域名，也就是正轨的https访问</li>
<li>必须域名，不能是ip</li>
<li>必须上传一个文件到域名根目录下面</li>
<li>iOS9</li>
</ol>
<blockquote>
<p>添加域名到我们的项目里面</p>
</blockquote>
<p><img src="http://7xpas5.com1.z0.glb.clouddn.com/66B41F17-9C42-43C5-9C7A-7A7D85C73081.png" alt="image"></p>
<p>这里的域名和我们将要上传文件的域名一致，可以包括一些子域名和扩展域名。app启动的时候，将会在这个域名下载我们上传的文件</p>
<blockquote>
<p>上传文件到我们的域名根目录下面</p>
</blockquote>
<p>使用编辑工具创建一个文本：文件名必须为apple-app-site-association</p>
<p>注：文本不能有后缀，我使用vim</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    "<span class="attribute">applinks</span>": <span class="value">&#123;</span><br><span class="line">        "<span class="attribute">apps</span>": <span class="value">[]</span>,</span><br><span class="line">        "<span class="attribute">details</span>": <span class="value">[</span><br><span class="line">            &#123;</span><br><span class="line">                "<span class="attribute">appID</span>": <span class="value"><span class="string">"ME8P9RGZ87.com.cc.CTChat"</span></span>,</span><br><span class="line">                "<span class="attribute">paths</span>": <span class="value">[ <span class="string">"*"</span>,<span class="string">"/*"</span>,<span class="string">"/home"</span>, <span class="string">"/cooperation"</span>,<span class="string">"/cooperationList"</span>,<span class="string">"/coopDetail"</span>,<span class="string">"/darenmine"</span>,<span class="string">"/merchantmine"</span>,<span class="string">"/darenhome"</span>,<span class="string">"/merchanthome"</span>,<span class="string">"/subject"</span>]</span><br><span class="line">            </span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    </span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>这里的appid为teamid+bundleid，teamid在苹果开发者账号下可以查到，bundleid在项目中</p>
<p>path为你想在链接的path为xxx的时候打开我们的应用</p>
<p>上传到我们的域名根目录下面。可以在<a href="https://search.developer.apple.com/appsearch-validation-tool/" target="_blank" rel="external">苹果开发工具</a>里面检测是否有效</p>
<blockquote>
<p>实现打开链接的协议</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application continueUserActivity:(<span class="built_in">NSUserActivity</span> *)userActivity restorationHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSArray</span> * _Nullable))restorationHandler&#123;</span><br><span class="line">    <span class="keyword">if</span> (userActivity<span class="variable">.activityType</span> == <span class="built_in">NSUserActivityTypeBrowsingWeb</span>) &#123;</span><br><span class="line">        <span class="built_in">NSURL</span> *url = userActivity<span class="variable">.webpageURL</span>;</span><br><span class="line">        <span class="keyword">if</span> (![<span class="keyword">self</span> handleUniversalLink:url]) &#123;</span><br><span class="line">            [[<span class="built_in">UIApplication</span> sharedApplication] openURL:url];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)handleUniversalLink:(<span class="built_in">NSURL</span>*)url&#123;<span class="comment">//这个为处理链接的方法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上就是所有步骤</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/11/iOS捕捉错误日志/" itemprop="url">
                  iOS捕捉错误日志
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-11T10:18:25+08:00" content="2016-03-11">
              2016-03-11
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="iOS捕捉错误日志">iOS捕捉错误日志</h2><blockquote>
<p>为什么需要自己实现错误crash捕捉</p>
</blockquote>
<p>目前我用过的错误获取第三方有：umeng，bughd</p>
<p>他们支持的收集有：设备信息，app版本号，时间，机型，错误信息等，但是有时候这些信息不足以让我们开发者定位到错误的地方，所以我希望拥有更详细的错误日志。例如用户的行为轨迹，错误发生的页面。那么我就需要把错误收集重写过。</p>
<p>1.重写错误收集需要捕捉系统发出的</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSetUncaughtExceptionHandler<span class="list">(<span class="keyword">&amp;uncatchExceptionHandler</span>)</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>2.然后新建一个类实现</p>
<p>获取信息，获取奔溃时屏幕快照等</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> uncatchExceptionHandler(<span class="built_in">NSException</span>*exception)&#123;</span><br><span class="line">    <span class="built_in">NSArray</span> *stackArray = [exception callStackSymbols];</span><br><span class="line">    <span class="built_in">NSString</span> *reason = [exception reason];</span><br><span class="line">    <span class="built_in">NSString</span> *name = [exception name];</span><br><span class="line">    <span class="built_in">NSString</span> *exceptionInfo = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"Exception reason：%@\nException name：%@\nException stack：%@"</span>,name, reason, stackArray];</span><br><span class="line">    [[SDImageCache sharedImageCache]storeImage:[CTCatCrash screenView] forKey:<span class="string">@"crashImage"</span>];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">UIImage</span>*)screenView&#123;</span><br><span class="line">    <span class="built_in">CGRect</span> rect = [<span class="built_in">UIScreen</span> mainScreen]<span class="variable">.bounds</span>;</span><br><span class="line">    <span class="built_in">UIGraphicsBeginImageContext</span>(rect<span class="variable">.size</span>);</span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    [[<span class="built_in">UIApplication</span> sharedApplication]<span class="variable">.keyWindow</span><span class="variable">.layer</span> renderInContext:context];</span><br><span class="line">    <span class="built_in">UIImage</span> *img = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</span><br><span class="line">    <span class="built_in">UIGraphicsEndImageContext</span>();</span><br><span class="line">    <span class="keyword">return</span> img;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.存储在本地，下次打开就进行上传到服务器，然后在清空这块数据</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/08/java-OSGI简单使用/" itemprop="url">
                  java OSGI简单使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-08T09:56:13+08:00" content="2016-03-08">
              2016-03-08
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>OGSI的项目流程</p>
</blockquote>
<h6 id="新建项目">新建项目</h6><ul>
<li>启动Eclipse，依次点 File –&gt; New –&gt; Project。</li>
<li>选择Plug-in Project，next。</li>
<li>输入Project Name项目名称，比如com.howard.sample.HelloWorld,Target Platform(目标* 平台)里的an OSGI framework，选择standard。</li>
<li>剩下的保持默认，next。</li>
<li>下个对话框也默认，next。</li>
<li>然后选择Hello OSGI Bundle作为模版。Finish。</li>
</ul>
<p>生成的项目中只包含两个文件：activator和mainfest</p>
<p>注：</p>
<ul>
<li>你的Activator类需要一个公有的无参数构造函数。OSGI框架会通过类反射的方式来实例化一个Activator类。</li>
<li>容器启动bundle过程中负责调用你的Activator类的start方法。bundle可以在此初始化资源比如说初始化数据库连接。start方法需要一个参数，BundleContext对象。这个对象允许bundles以取得OSGI容器相关信息的方式和框架交互。如果某一个bundle有异常抛出，容器将对该bundle标记为stopped并不将其纳入service列表。</li>
<li>容器关闭的时候会调用你的Activator类方法stop(),你可以利用这个机会做一些清理的操作。</li>
</ul>
<p>mainfest里面的值：</p>
<ul>
<li>Bundle-ManifestVersion<br>   数值为2意味着本bundle支持OSGI规范第四版；如果是1那就是支持OSGI规范第三版。</li>
<li>Bundle-Name<br>   给bundle定义一个短名，方便人员阅读</li>
<li>Bundle-SymbolicName<br>   给bundle定义一个唯一的非局部名。方便分辨。</li>
<li>Bundle-Activator<br>   声明在start和stop事件发生时会被通知的监听类的名字。</li>
<li>Import-Package<br>   定义bundle的导入包。</li>
</ul>
<h6 id="运行项目">运行项目</h6><ul>
<li>点击Run –&gt; Run Configuration</li>
<li>在左边的OSGI Framework选项里右键 new ，创建一个新的OSGI Run Configuration<br>名字随便取好了，我们取个OSGi hello world。</li>
<li>你会注意到中间的窗口里Workspace项目里有一子项 我们刚新建的项目,将其勾选上，其他的不用管。这时的状态应该如下图。<br>点击Run按钮。在控制台你应该可以看见点东西了。那是叫做OSGI控制台的东东。与子相伴，还有一个我们start里面输出的东西。</li>
</ul>
<h6 id="依赖管理">依赖管理</h6><ol>
<li>创建一个被依赖的项目：com.xxxservice</li>
<li>在mainfest里面runtime的exported package选项里面导入我们的项目com.xxxservice</li>
<li>创建一个依赖上面项目的项目：com.xxx</li>
<li>在mainfest里面的dependencies里面import packages导入com.xxxservice</li>
<li>然后在com.xxx的activator里面使用com.xxxservice里面的接口等</li>
</ol>
<h6 id="可见区域">可见区域</h6><p>osgi的容器自定义了java class loader来有选择的加载类ogsi为每个bundle都创建的不同的class loader，所以bundle能访问的classes包括：</p>
<ul>
<li>Boot classpath：所有的java基础类。</li>
<li>Framework classpath：OSGI框架级别的classloader加载的类</li>
<li>Bundle classpath：Bundle本身引用的关系紧密的JAR的路径</li>
<li>Imported packages：就是在MANIFEST.MF里声明的导入包，一旦声明，在bundle内就可见了。</li>
</ul>
<h6 id="导出services">导出services</h6><p>假设我们com.xxxservice里面新建了一个serviceActivator implements BundleActivator代码如下</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class <span class="type">HelloServiceActivator</span> implements <span class="type">BundleActivator</span> &#123;</span><br><span class="line">	<span class="type">ServiceRegistration</span> helloServiceRegistration;</span><br><span class="line">	@<span class="type">Override</span></span><br><span class="line">	public <span class="type">void</span> start(<span class="type">BundleContext</span> arg0) throws <span class="type">Exception</span> &#123;</span><br><span class="line">		// <span class="type">TODO</span> <span class="type">Auto</span>-generated <span class="keyword">method</span> stub</span><br><span class="line">		<span class="type">HelloService</span> hello = new <span class="type">HelloServiceImp</span>();</span><br><span class="line">		helloServiceRegistration = arg0.registerService(<span class="type">HelloService</span>.class.getName(), hello, null);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@<span class="type">Override</span></span><br><span class="line">	public <span class="type">void</span> stop(<span class="type">BundleContext</span> arg0) throws <span class="type">Exception</span> &#123;</span><br><span class="line">		// <span class="type">TODO</span> <span class="type">Auto</span>-generated <span class="keyword">method</span> stub</span><br><span class="line">		helloServiceRegistration.unregister();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>改变mainfest里面的bundle-activator为这个</p>
<p>导入：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> Activator <span class="keyword">implements</span> BundleActivator &#123;</span><br><span class="line"></span><br><span class="line">	ServiceReference helloServiceReference;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> start(BundleContext context) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		System.out.<span class="keyword">println</span>(<span class="string">"start World!!"</span>);</span><br><span class="line">		 helloServiceReference = context.getServiceReference(HelloService.<span class="keyword">class</span>.getName());</span><br><span class="line">		 HelloService hello = (HelloService)context.getService(helloServiceReference);</span><br><span class="line">		 System.out.<span class="keyword">println</span>(hello.sayHello());</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> stop(BundleContext context) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		System.out.<span class="keyword">println</span>(<span class="string">"Goodbye World!!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="创建服务工厂">创建服务工厂</h6><p>上面我们是在bundle启动的时候去创建和注册service，有时候service十分耗资源，希望用的时候创建，其他时候销毁。</p>
<p>解决问题：使用ServiceFactory接口实现来代替原来的实现方式</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class <span class="type">HelloServiceFactory</span> implements <span class="type">ServiceFactory</span> &#123;</span><br><span class="line">	private <span class="type">int</span> usageCounter = <span class="number">0</span>;</span><br><span class="line">	@<span class="type">Override</span></span><br><span class="line">	public <span class="type">Object</span> getService(<span class="type">Bundle</span> arg0, <span class="type">ServiceRegistration</span> arg1) &#123;</span><br><span class="line">		// <span class="type">TODO</span> <span class="type">Auto</span>-generated <span class="keyword">method</span> stub</span><br><span class="line">		<span class="type">System</span>.<span class="keyword">out</span>.println(<span class="string">"create object of hellservice for"</span> + arg0.getSymbolicName());</span><br><span class="line">		usageCounter ++;</span><br><span class="line">		<span class="type">System</span>.<span class="keyword">out</span>.println(<span class="string">"number of bundle using service"</span> + usageCounter);</span><br><span class="line">		<span class="type">HelloService</span> helloService = new <span class="type">HelloServiceImp</span>();</span><br><span class="line">		<span class="keyword">return</span> helloService;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@<span class="type">Override</span></span><br><span class="line">	public <span class="type">void</span> ungetService(<span class="type">Bundle</span> arg0, <span class="type">ServiceRegistration</span> arg1, <span class="type">Object</span> arg2) &#123;</span><br><span class="line">		// <span class="type">TODO</span> <span class="type">Auto</span>-generated <span class="keyword">method</span> stub</span><br><span class="line"></span><br><span class="line">        <span class="type">System</span>.<span class="keyword">out</span>.println(<span class="string">"Release object of HelloService for "</span> + arg0.getSymbolicName());  </span><br><span class="line">        usageCounter--;  </span><br><span class="line">        <span class="type">System</span>.<span class="keyword">out</span>.println(<span class="string">"Number of bundles using service "</span> + usageCounter); </span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改HelloService的start方法</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HelloServiceFactory <span class="literal">factory</span> = <span class="keyword">new</span> HelloServiceFactory();</span><br><span class="line">helloServiceRegistration = arg0.registerService(HelloService.<span class="keyword">class</span>.getName(), <span class="literal">factory</span>, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
<h6 id="services跟踪">services跟踪</h6><p>1.在HelloWorld bundle里的MANIFEST.MF导入org.util.tracker包。</p>
<p>2.创建HelloServiceTracker类，代码如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">HelloServiceTracker</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">ServiceTracker</span> &#123;</span>  </span><br><span class="line">    public <span class="type">HelloServiceTracker</span>(<span class="type">BundleContext</span> context) &#123;  </span><br><span class="line">        <span class="keyword">super</span>(context, <span class="type">HelloService</span>.<span class="keyword">class</span>.getName(),<span class="literal">null</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    public <span class="type">Object</span> addingService(<span class="type">ServiceReference</span> reference) &#123;  </span><br><span class="line">        <span class="type">System</span>.out.println(<span class="string">"Inside HelloServiceTracker.addingService "</span> + reference.getBundle());  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.addingService(reference);  </span><br><span class="line">    &#125;  </span><br><span class="line">    public void removedService(<span class="type">ServiceReference</span> reference, <span class="type">Object</span> service) &#123;  </span><br><span class="line">        <span class="type">System</span>.out.println(<span class="string">"Inside HelloServiceTracker.removedService "</span> + reference.getBundle());  </span><br><span class="line">        <span class="keyword">super</span>.removedService(reference, service);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.修改调用方： </p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">helloServiceTracker = new HelloServiceTracker(context)<span class="comment">;</span></span><br><span class="line">helloServiceTracker.open()<span class="comment">;</span></span><br><span class="line">HelloService hello = (HelloService)helloServiceTracker.getService()<span class="comment">;</span></span><br><span class="line">System.out.println(hello.sayHello())<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>OGSI命令</p>
</blockquote>
<p>下面列出一些常用的OSGI命令，你可以试着和OSGI容器交互。</p>
<ol>
<li>ss 显示已安装的bundles的状态信息，信息包括bundle ID，短名，状态等等。</li>
<li>start 启动一个bundle</li>
<li>stop  关闭一个bundle</li>
<li>update  载入一个新的JAR文件更新一个bundle</li>
<li>install  安装一个新的bundle到容器中</li>
<li>uninstall  卸载一个已在容器中的bundle</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/26/gcd深入理解/" itemprop="url">
                  gcd深入理解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-26T15:22:47+08:00" content="2016-02-26">
              2016-02-26
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="GCD基本概念">GCD基本概念</h3><ol>
<li>gcd里面有三种队列(queue)</li>
</ol>
<blockquote>
<p>主线程队列 ：main_queue </p>
</blockquote>
<p>由 dispatch_get_main_queue()获取；</p>
<blockquote>
<p>并行队列：global dispatch queue</p>
</blockquote>
<p>由dispatch_get_global_queue(int,int);</p>
<p>由系统创建三个不同优先级的队列，并行队列的执行顺序和加入顺序一致，完成顺序不确定，</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DISPATCH_QUEUE_PRIORITY_HIGH <span class="number">2</span></span><br><span class="line">DISPATCH_QUEUE_PRIORITY_DEFAULT <span class="number">0</span></span><br><span class="line">DISPATCH_QUEUE_PRIORITY_LOW －<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>或者使用dispatch_queue_create(“”, DISPATCH_QUEUE_CONCURRENT);创建</p>
<blockquote>
<p>串行队列：serial queue</p>
</blockquote>
<p>dispatch_queue_create(“”, DISPATCH_QUEUE_SERIAL);//DISPATCH_QUEUE_SERIAL=NULL</p>
<p>顺序同步访问，可以创建大量串行队列，各个队列之间是并发的，队列里面每次只能执行一个任务，这样可以保护数据，有锁的功能</p>
<h4 id="简单用法">简单用法</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="comment">//dispatch_async异步执行</span></span><br><span class="line"> dispatch_async(mainQueue, ^&#123;</span><br><span class="line">     [NSThread sleepForTimeInterval:<span class="number">5</span>];</span><br><span class="line"> &#125;);</span><br><span class="line">  <span class="comment">//dispatch_sync阻塞执行</span></span><br><span class="line">  dispatch_sync(mainQueue, ^&#123;</span><br><span class="line">  [NSThread sleepForTimeInterval:<span class="number">5</span>];</span><br><span class="line">  &#125;);<span class="comment">//这样会死锁主线程  dispatch_sync等待block执行完，block需要在主线程中运行，相互死锁</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">//2.gcd group用法</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">dispatch_group_t</span> group = dispatch_group_create();</span><br><span class="line"> dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class="line">     <span class="comment">//</span></span><br><span class="line"> &#125;);</span><br><span class="line"> dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class="line">     </span><br><span class="line"> &#125;);</span><br><span class="line"> dispatch_group_notify(group, mainQueue, ^&#123;</span><br><span class="line">     <span class="comment">//group执行完后</span></span><br><span class="line"> &#125;);</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//如果是新启一个线程去执行任务，可以使用enter和leave</span></span><br><span class="line"> dispatch_group_enter(group);</span><br><span class="line"> dispatch_group_leave(group);</span><br><span class="line"> </span><br><span class="line"> <span class="number">3.</span> dispatch_after</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//延迟执行</span></span><br><span class="line"> </span><br><span class="line"> dispatch_after(<span class="number">3.0</span>, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="用途">用途</h4><p>信号量dispatch semaphore</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">dispatch_semaphore_create</span>(1);<span class="comment">//创建一个初始信号量为1的semaphore</span></span><br><span class="line"><span class="function">dispatch_semaphore_wait</span>(semaphore, DISPATCH_TIME_FOREVER);<span class="comment">//等待信号量大于0，时间：永远</span></span><br><span class="line"><span class="function">dispatch_semaphore_signal</span>(semaphore);<span class="comment">//释放一个资源，使信号量加1</span></span><br></pre></td></tr></table></figure>
<p>分发栅栏dispatch barrier</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">dispatch_barrier_async</span>(queue, ^&#123;</span><br><span class="line">&#125;);<span class="comment">//作用等待queue里面的操作完成后进行block操作</span></span><br></pre></td></tr></table></figure>
<p>分发源dispatch source//待补充</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">监听指定的各种事件</span><br><span class="line">变量增加dispatch_<span class="built_in">source</span>_<span class="built_in">type</span>_data_add</span><br><span class="line">变量OR  dispatch_<span class="built_in">source</span>_<span class="built_in">type</span>_data_or</span><br><span class="line">进程相关dispatch_<span class="built_in">source</span>_<span class="built_in">type</span>_proc</span><br><span class="line">文件读写</span><br><span class="line">.......</span><br></pre></td></tr></table></figure>
<h4 id="GCD实现operation的功能">GCD实现operation的功能</h4><p>operation提供的功能有：</p>
<blockquote>
<p>取消<br>开始<br>依赖<br>获取各种状态：op.isCancelled，op.isExecuting，op.isFinished，op.isReady，op.isConcurrent</p>
</blockquote>
<p>感觉就是各种标志位的组合使用。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/25/c-学习-一-之基本概念/" itemprop="url">
                  c++学习(一)之基本概念
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-25T13:42:22+08:00" content="2016-02-25">
              2016-02-25
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>C++命名空间</p>
</blockquote>
<p>为了避免命名冲突，c++ 引入命名空间</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">A</span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">B</span>&#123;</span><br><span class="line">	<span class="keyword">bool</span> flag=<span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>若把两个变量放入一个函数体里面使用，则需要指明是哪个命名空间里的,使用域解析操作符”::”操作符</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;&#36824;&#21487;&#20197;&#20351;&#29992;using&#65292;using&#22768;&#26126;&#21518;&#38754;&#30340;flag&#26159;&#23646;&#20110;&#21738;&#19968;&#20010;&#21629;&#21517;&#31354;&#38388;&#37324;&#38754;&#30340;&#12290; using A:flag;&#34920;&#31034;&#21518;&#38754;flag&#37117;&#26159;A&#37324;&#38754;&#30340;&#65292;&#32780;B&#37324;&#38754;&#30340;flag&#36824;&#26159;&#35201;&#29992;B:flag&#21435;&#35843;&#29992;&#10;&#10;&#21516;&#29702;using&#21487;&#20197;&#30452;&#25509;&#29992;namespace&#65292;using namespace A,&#34920;&#31034;A&#37324;&#38754;&#25152;&#26377;&#21464;&#37327;&#37117;&#30452;&#25509;&#33021;&#20351;&#29992;&#10;&#10;&#10;&#62; c&#25351;&#38024;&#10;&#10;&#20989;&#25968;&#25351;&#38024;&#65306;&#25351;&#21521;&#20989;&#25968;&#30340;&#25351;&#38024;</span><br></pre></td></tr></table></figure>
<p>int max(a,b){<br>}</p>
<p>main(){<br>int (*mMax)();<br>mMax = max;</p>
<p>int i = (*mMax)(a,b);<br>}<br>```</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://7xoou1.com1.z0.glb.clouddn.com/default_portrait"
               alt="黄 成" />
          <p class="site-author-name" itemprop="name">黄 成</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">34</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>
          
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">黄 成</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  



  



  
  
  

  


</body>
</html>
